{"version":3,"sources":["../src/data-model.js"],"names":["StaticValues","valuesFrom","yesNoValues","clone","ConditionsModel","filter","obj","predicate","result","key","Input","constructor","rawData","page","options","Object","assign","myPage","components","propertyPath","ignoreSection","section","name","parentItemName","displayName","titleWithContext","title","Condition","expression","value","from","toExpression","ValuesWrapper","values","data","toStaticValues","Data","oldPath","newPath","pages","p","next","find","link","path","forEach","rawDataClone","_exposePrivateFields","conditions","map","it","feedback","lists","sections","_listInputsFor","input","valuesFor","items","flatMap","listItem","children","label","allInputs","inputs","component","concat","feedbackForm","startPage","findPage","FEEDBACK_CONTEXT_ITEMS","push","type","display","names","Set","isPresent","has","add","inputsAccessibleAt","precedingPages","_allPathsLeadingTo","includes","getPages","findList","listName","list","addLink","to","condition","fromPage","toPage","existingLink","addSection","s","updateLink","addPage","_valuesFor","addCondition","Error","addComponent","pagePath","updateComponent","componentName","index","findIndex","updateCondition","removeCondition","findCondition","splice","Array","isArray","n","if","hasConditions","length","undefined","setFeedbackUrl","feedbackUrl","url","toJSON","withoutFunctions","field","toSerialize","get","contextInfo","formTitle","pageTitle"],"mappings":";;;AAEA,SAASA,YAAT,EAAuBC,UAAvB,EAAmCC,WAAnC,QAAsD,UAAtD;AAGA,SAASC,KAAT,QAAsB,WAAtB;AACA,SAASC,eAAT,QAAgC,cAAhC;;AAEA,SAASC,MAAT,CAAiBC,GAAjB,EAA2BC,SAA3B,EAAqD;AACnD,QAAMC,MAAM,GAAG,EAAf;AACA,MAAIC,GAAJ;;AACA,OAAKA,GAAL,IAAYH,GAAZ,EAAiB;AACf,QAAIA,GAAG,CAACG,GAAD,CAAH,IAAYF,SAAS,CAACD,GAAG,CAACG,GAAD,CAAJ,CAAzB,EAAqC;AACnCD,MAAAA,MAAM,CAACC,GAAD,CAAN,GAAcH,GAAG,CAACG,GAAD,CAAjB;AACD;AACF;;AACD,SAAOD,MAAP;AACD;;;;AAED,MAAME,KAAN,CAAY;AAOVC,EAAAA,WAAW,CAAEC,OAAF,EAAgBC,IAAhB,EAA2BC,OAAY,GAAG,EAA1C,EAA8C;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AACvDC,IAAAA,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoBJ,OAApB;AACA,UAAMK,MAAM,GAAGd,KAAK,CAACU,IAAD,CAApB;AACA,WAAOI,MAAM,CAACC,UAAd;AACA,SAAKL,IAAL,GAAYI,MAAZ;AACA,SAAKE,YAAL,GAAoB,CAACL,OAAO,CAACM,aAAT,IAA0BP,IAAI,CAACQ,OAA/B,GAA0C,GAAER,IAAI,CAACQ,OAAQ,IAAG,KAAKC,IAAK,EAAtE,GAA0E,KAAKA,IAAnG;;AACA,iDAAuBR,OAAO,CAACS,cAA/B;AACD;;AAED,MAAIC,WAAJ,GAAmB;AACjB,UAAMC,gBAAgB,GAAG,+CAAwB,GAAE,KAAKC,KAAM,UAAd,sBAAuB,IAAvB,kBAA4C,EAAnE,GAAuE,KAAKA,KAArG;AACA,WAAO,KAAKb,IAAL,CAAUQ,OAAV,GAAqB,GAAEI,gBAAiB,OAAM,KAAKZ,IAAL,CAAUQ,OAAQ,EAAhE,GAAoEI,gBAA3E;AACD;;AAnBS;;AAsBZ,OAAO,MAAME,SAAN,CAAgB;AAKrBhB,EAAAA,WAAW,CAAEC,OAAF,EAAgB;AAAA;;AAAA;;AAAA;;AACzBG,IAAAA,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoBJ,OAApB;AACA,SAAKY,WAAL,GAAmBZ,OAAO,CAACY,WAAR,IAAuBZ,OAAO,CAACU,IAAlD;AACD;;AAED,MAAIM,UAAJ,GAAkB;AAChB,QAAI,OAAO,KAAKC,KAAZ,KAAsB,QAA1B,EAAoC;AAClC,aAAO,KAAKA,KAAZ;AACD,KAFD,MAEO;AACL,aAAOzB,eAAe,CAAC0B,IAAhB,CAAqB,KAAKD,KAA1B,EAAiCE,YAAjC,EAAP;AACD;AACF;;AAED5B,EAAAA,KAAK,GAAI;AACP,WAAO,IAAIwB,SAAJ,CAAc,IAAd,CAAP;AACD;;AApBoB;;AAuBvB,MAAMK,aAAN,CAAoB;AAIlBrB,EAAAA,WAAW,CAAEsB,MAAF,EAA2BC,IAA3B,EAA4C;AAAA;;AAAA;;AACrD,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACD;;AAEDC,EAAAA,cAAc,GAAmB;AAC/B,WAAO,KAAKF,MAAL,CAAYE,cAAZ,CAA2B,KAAKD,IAAhC,CAAP;AACD;;AAXiB;;;;;;;;AAcpB,OAAO,MAAME,IAAN,CAAgC;AACrC;;;;AAkBAzB,EAAAA,WAAW,CAAEC,OAAF,EAAgB;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA,2CA+FX,UAAUyB,OAAV,EAA2BC,OAA3B,EAAkD;AAChE,WAAKC,KAAL,CAAWlC,MAAX,CAAkBmC,CAAC,IAAIA,CAAC,CAACC,IAAF,IAAUD,CAAC,CAACC,IAAF,CAAOC,IAAP,CAAYC,IAAI,IAAIA,IAAI,CAACC,IAAL,KAAcP,OAAlC,CAAjC,EACGQ,OADH,CACWhC,IAAI,IAAI;AACfA,QAAAA,IAAI,CAAC4B,IAAL,CAAUC,IAAV,CAAeC,IAAI,IAAIA,IAAI,CAACC,IAAL,KAAcP,OAArC,EAA8CO,IAA9C,GAAqDN,OAArD;AACD,OAHH;AAIA,aAAO,IAAP;AACD,KArG0B;;AACzB,UAAMQ,YAAY,GAAGlC,OAAO,YAAYwB,IAAnB,GAA0BxB,OAAO,CAACmC,oBAAR,EAA1B,GAA2DhC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBJ,OAAlB,CAAhF;;AACA,6CAAmB,CAACkC,YAAY,CAACE,UAAb,IAA2B,EAA5B,EAAgCC,GAAhC,CAAoCC,EAAE,IAAI,IAAIvB,SAAJ,CAAcuB,EAAd,CAA1C,CAAnB;;AACA,2CAAiBJ,YAAY,CAACK,QAA9B;;AACA,WAAOL,YAAY,CAACE,UAApB;AACA,WAAOF,YAAY,CAACK,QAApB;AACApC,IAAAA,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoB8B,YAApB;AACA,SAAKP,KAAL,GAAa,KAAKA,KAAL,IAAc,EAA3B;AACA,SAAKa,KAAL,GAAa,KAAKA,KAAL,IAAc,EAA3B;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,IAAiB,EAAjC;AACD;;AAEDC,EAAAA,cAAc,CAAEzC,IAAF,EAAa0C,KAAb,EAAuC;AAAA;;AACnD,UAAMtB,MAAM,sBAAG,KAAKuB,SAAL,CAAeD,KAAf,CAAH,oDAAG,gBAAuBpB,cAAvB,EAAf;AACA,WAAOF,MAAM,GAAGA,MAAM,CAACwB,KAAP,CAAaC,OAAb,CAAqBC,QAAQ;AAAA;;AAAA,4DAAIA,QAAQ,CAACC,QAAb,iFAAI,mBAC7CvD,MAD6C,CACtC6C,EAAE,IAAIA,EAAE,CAAC5B,IAD6B,CAAJ,2DAAI,uBAE7C2B,GAF6C,CAEzCC,EAAE,IAAI,IAAIxC,KAAJ,CAAUwC,EAAV,EAAcrC,IAAd,EAAoB;AAAEU,QAAAA,cAAc,EAAEoC,QAAQ,CAACE;AAA3B,OAApB,CAFmC,CAAJ,yEAE6B,EAF7B;AAAA,KAA7B,CAAH,GAEmE,EAFhF;AAGD;;AAEDC,EAAAA,SAAS,GAAkB;AACzB,UAAMC,MAAoB,GAAG,KAAKxB,KAAL,CAC1BmB,OAD0B,CAClB7C,IAAI,IAAI,CAACA,IAAI,CAACK,UAAL,IAAmB,EAApB,EACdb,MADc,CACP2D,SAAS,IAAIA,SAAS,CAAC1C,IADhB,EAEdoC,OAFc,CAENR,EAAE,IAAI,CAAC,IAAIxC,KAAJ,CAAUwC,EAAV,EAAcrC,IAAd,CAAD,EAAsBoD,MAAtB,CAA6B,KAAKX,cAAL,CAAoBzC,IAApB,EAA0BqC,EAA1B,CAA7B,CAFA,CADU,CAA7B;;AAKA,QAAI,KAAKgB,YAAT,EAAuB;AACrB,YAAMC,SAAS,GAAG,KAAKC,QAAL,CAAc,KAAKD,SAAnB,CAAlB;AACA,YAAMrD,OAAO,GAAG;AAAEM,QAAAA,aAAa,EAAE;AAAjB,OAAhB;AACAgB,MAAAA,IAAI,CAACiC,sBAAL,CAA4BxB,OAA5B,CAAoCK,EAAE,IAAI;AACxCa,QAAAA,MAAM,CAACO,IAAP,CAAY,IAAI5D,KAAJ,CAAU;AAAE6D,UAAAA,IAAI,EAAE,WAAR;AAAqB7C,UAAAA,KAAK,EAAEwB,EAAE,CAACsB,OAA/B;AAAwClD,UAAAA,IAAI,EAAE4B,EAAE,CAACzC;AAAjD,SAAV,EAAkE0D,SAAlE,EAA6ErD,OAA7E,CAAZ;AACD,OAFD;AAGD;;AACD,UAAM2D,KAAK,GAAG,IAAIC,GAAJ,EAAd;AACA,WAAOX,MAAM,CAAC1D,MAAP,CAAekD,KAAD,IAAkB;AACrC,YAAMoB,SAAS,GAAG,CAACF,KAAK,CAACG,GAAN,CAAUrB,KAAK,CAACpC,YAAhB,CAAnB;AACAsD,MAAAA,KAAK,CAACI,GAAN,CAAUtB,KAAK,CAACpC,YAAhB;AACA,aAAOwD,SAAP;AACD,KAJM,CAAP;AAKD;;AAEDG,EAAAA,kBAAkB,CAAElC,IAAF,EAA8B;AAC9C,UAAMmC,cAAc,GAAG,KAAKC,kBAAL,CAAwBpC,IAAxB,CAAvB;;AACA,WAAO,KAAKkB,SAAL,GAAiBzD,MAAjB,CAAwB6C,EAAE,IAAI6B,cAAc,CAACE,QAAf,CAAwB/B,EAAE,CAACrC,IAAH,CAAQ+B,IAAhC,KAAyCA,IAAI,KAAKM,EAAE,CAACrC,IAAH,CAAQ+B,IAAxF,CAAP;AACD;;AAEDwB,EAAAA,QAAQ,CAAExB,IAAF,EAAqB;AAC3B,WAAO,KAAKsC,QAAL,GAAgBxC,IAAhB,CAAqBF,CAAC,IAAIA,CAAC,CAACI,IAAF,KAAWA,IAArC,CAAP;AACD;;AAEDuC,EAAAA,QAAQ,CAAEC,QAAF,EAAyB;AAC/B,WAAO,KAAKhC,KAAL,CAAWV,IAAX,CAAgB2C,IAAI,IAAIA,IAAI,CAAC/D,IAAL,KAAc8D,QAAtC,CAAP;AACD;;AAEDE,EAAAA,OAAO,CAAExD,IAAF,EAAgByD,EAAhB,EAA4BC,SAA5B,EAAsD;AAC3D,UAAMC,QAAQ,GAAG,KAAKlD,KAAL,CAAWG,IAAX,CAAgBF,CAAC,IAAIA,CAAC,CAACI,IAAF,KAAWd,IAAhC,CAAjB;AACA,UAAM4D,MAAM,GAAG,KAAKnD,KAAL,CAAWG,IAAX,CAAgBF,CAAC,IAAIA,CAAC,CAACI,IAAF,KAAW2C,EAAhC,CAAf;;AACA,QAAIE,QAAQ,IAAIC,MAAhB,EAAwB;AAAA;;AACtB,YAAMC,YAAY,qBAAGF,QAAQ,CAAChD,IAAZ,mDAAG,eAAeC,IAAf,CAAoBQ,EAAE,IAAIA,EAAE,CAACN,IAAH,KAAY2C,EAAtC,CAArB;;AACA,UAAI,CAACI,YAAL,EAAmB;AACjB,cAAMhD,IAAI,GAAG,EAAb;AACAA,QAAAA,IAAI,CAACC,IAAL,GAAY2C,EAAZ;;AACA,YAAIC,SAAJ,EAAe;AACb7C,UAAAA,IAAI,CAAC6C,SAAL,GAAiBA,SAAjB;AACD;;AAEDC,QAAAA,QAAQ,CAAChD,IAAT,GAAgBgD,QAAQ,CAAChD,IAAT,IAAiB,EAAjC;AACAgD,QAAAA,QAAQ,CAAChD,IAAT,CAAc6B,IAAd,CAAmB3B,IAAnB;AACD;AACF;;AACD,WAAO,IAAP;AACD;;AAEDiD,EAAAA,UAAU,CAAEtE,IAAF,EAAgBI,KAAhB,EAAsC;AAC9C,QAAI,CAAC,KAAK2B,QAAL,CAAcX,IAAd,CAAmBmD,CAAC,IAAIA,CAAC,CAACvE,IAAF,KAAWA,IAAnC,CAAL,EAA+C;AAC7C,WAAK+B,QAAL,CAAciB,IAAd,CAAmB;AAAEhD,QAAAA,IAAF;AAAQI,QAAAA;AAAR,OAAnB;AACD;;AACD,WAAO,IAAP;AACD;;AAEDoE,EAAAA,UAAU,CAAEhE,IAAF,EAAgByD,EAAhB,EAA4BC,SAA5B,EAAqD;AAC7D,UAAMC,QAAQ,GAAG,KAAKrB,QAAL,CAActC,IAAd,CAAjB;AACA,UAAM4D,MAAM,GAAG,KAAKnD,KAAL,CAAWG,IAAX,CAAgBF,CAAC,IAAIA,CAAC,CAACI,IAAF,KAAW2C,EAAhC,CAAf;;AACA,QAAIE,QAAQ,IAAIC,MAAhB,EAAwB;AAAA;;AACtB,YAAMC,YAAY,sBAAGF,QAAQ,CAAChD,IAAZ,oDAAG,gBAAeC,IAAf,CAAoBQ,EAAE,IAAIA,EAAE,CAACN,IAAH,KAAY2C,EAAtC,CAArB;;AACA,UAAII,YAAJ,EAAkB;AAChB,YAAIH,SAAJ,EAAe;AACbG,UAAAA,YAAY,CAACH,SAAb,GAAyBA,SAAzB;AACD,SAFD,MAEO;AACL,iBAAOG,YAAY,CAACH,SAApB;AACD;AACF;AACF;;AACD,WAAO,IAAP;AACD;;AAUDO,EAAAA,OAAO,CAAElF,IAAF,EAAmB;AACxB,SAAK0B,KAAL,CAAW+B,IAAX,CAAgBzD,IAAhB;AACA,WAAO,IAAP;AACD;;AAEDqE,EAAAA,QAAQ,GAAgB;AACtB,WAAO,KAAK3C,KAAZ;AACD;;AAEDiB,EAAAA,SAAS,CAAED,KAAF,EAA8B;AACrC,UAAMtB,MAAM,GAAG,KAAK+D,UAAL,CAAgBzC,KAAhB,CAAf;;AACA,QAAItB,MAAJ,EAAY;AACV,aAAO,IAAID,aAAJ,CAAkBC,MAAlB,EAA0B,IAA1B,CAAP;AACD;AACF;;AAED+D,EAAAA,UAAU,CAAEzC,KAAF,EAAgC;AACxC,QAAIA,KAAK,CAACgB,IAAN,KAAe,YAAnB,EAAiC;AAC/B,aAAOrE,WAAP;AACD;;AACD,QAAIqD,KAAK,CAACtB,MAAV,EAAkB;AAChB,aAAOhC,UAAU,CAACsD,KAAK,CAACtB,MAAP,CAAjB;AACD;AACF;;AAED+C,EAAAA,kBAAkB,CAAEpC,IAAF,EAA+B;AAC/C,WAAO,KAAKL,KAAL,CAAWlC,MAAX,CAAkBQ,IAAI,IAAIA,IAAI,CAAC4B,IAAL,IAAa5B,IAAI,CAAC4B,IAAL,CAAUC,IAAV,CAAeD,IAAI,IAAIA,IAAI,CAACG,IAAL,KAAcA,IAArC,CAAvC,EACJc,OADI,CACI7C,IAAI,IAAI,CAACA,IAAI,CAAC+B,IAAN,EAAYqB,MAAZ,CAAmB,KAAKe,kBAAL,CAAwBnE,IAAI,CAAC+B,IAA7B,CAAnB,CADZ,CAAP;AAED;;AAEDqD,EAAAA,YAAY,CAAE3E,IAAF,EAAgBE,WAAhB,EAAqCK,KAArC,EAAuD;AACjE,mEAAmB,IAAnB;;AACA,QAAI,yCAAiBa,IAAjB,CAAsBQ,EAAE,IAAIA,EAAE,CAAC5B,IAAH,KAAYA,IAAxC,CAAJ,EAAmD;AACjD,YAAM4E,KAAK,CAAE,wCAAuC5E,IAAK,EAA9C,CAAX;AACD;;AACD,6CAAiBgD,IAAjB,CAAsB;AAAEhD,MAAAA,IAAF;AAAQE,MAAAA,WAAR;AAAqBK,MAAAA;AAArB,KAAtB;;AACA,WAAO,IAAP;AACD;;AAEDsE,EAAAA,YAAY,CAAEC,QAAF,EAAoBpC,SAApB,EAA0C;AACpD,UAAMnD,IAAI,GAAG,KAAKuD,QAAL,CAAcgC,QAAd,CAAb;;AACA,QAAIvF,IAAJ,EAAU;AACRA,MAAAA,IAAI,CAACK,UAAL,GAAkBL,IAAI,CAACK,UAAL,IAAmB,EAArC;AACAL,MAAAA,IAAI,CAACK,UAAL,CAAgBoD,IAAhB,CAAqBN,SAArB;AACD,KAHD,MAGO;AACL,YAAMkC,KAAK,CAAE,4BAA2BE,QAAS,EAAtC,CAAX;AACD;;AACD,WAAO,IAAP;AACD;;AAEDC,EAAAA,eAAe,CAAED,QAAF,EAAoBE,aAApB,EAA2CtC,SAA3C,EAAiE;AAC9E,UAAMnD,IAAI,GAAG,KAAKuD,QAAL,CAAcgC,QAAd,CAAb;;AACA,QAAIvF,IAAJ,EAAU;AACRA,MAAAA,IAAI,CAACK,UAAL,GAAkBL,IAAI,CAACK,UAAL,IAAmB,EAArC;AACA,YAAMqF,KAAK,GAAG1F,IAAI,CAACK,UAAL,CAAgBsF,SAAhB,CAA0BtD,EAAE,IAAIA,EAAE,CAAC5B,IAAH,KAAYgF,aAA5C,CAAd;;AACA,UAAIC,KAAK,GAAG,CAAZ,EAAe;AACb,cAAML,KAAK,CAAE,iCAAgCI,aAAc,2BAA0BF,QAAS,EAAnF,CAAX;AACD;;AACDvF,MAAAA,IAAI,CAACK,UAAL,CAAgBqF,KAAhB,IAAyBvC,SAAzB;AACD,KAPD,MAOO;AACL,YAAMkC,KAAK,CAAE,4BAA2BE,QAAS,EAAtC,CAAX;AACD;;AACD,WAAO,IAAP;AACD;;AAEDK,EAAAA,eAAe,CAAEnF,IAAF,EAAgBE,WAAhB,EAAqCK,KAArC,EAAuD;AACpE,UAAM2D,SAAS,GAAG,yCAAiB9C,IAAjB,CAAsB8C,SAAS,IAAIA,SAAS,CAAClE,IAAV,KAAmBA,IAAtD,CAAlB;;AACA,QAAIkE,SAAJ,EAAe;AACbA,MAAAA,SAAS,CAAChE,WAAV,GAAwBA,WAAxB;AACAgE,MAAAA,SAAS,CAAC3D,KAAV,GAAkBA,KAAlB;AACD;;AACD,WAAO,IAAP;AACD;;AAED6E,EAAAA,eAAe,CAAEpF,IAAF,EAAsB;AACnC,UAAMkE,SAAS,GAAG,KAAKmB,aAAL,CAAmBrF,IAAnB,CAAlB;;AACA,QAAIkE,SAAJ,EAAe;AACb,+CAAiBoB,MAAjB,CAAwB,yCAAiBJ,SAAjB,CAA2BhB,SAAS,IAAIA,SAAS,CAAClE,IAAV,KAAmBA,IAA3D,CAAxB,EAA0F,CAA1F,EADa,CAEb;;;AACA,WAAK4D,QAAL,GAAgBrC,OAAhB,CAAwBL,CAAC,IAAI;AAC3BqE,QAAAA,KAAK,CAACC,OAAN,CAActE,CAAC,CAACC,IAAhB,KAAyBD,CAAC,CAACC,IAAF,CAAOI,OAAP,CAAekE,CAAC,IAAI;AAC3C,cAAIA,CAAC,CAACC,EAAF,KAAS1F,IAAb,EAAmB;AACjB,mBAAOyF,CAAC,CAACC,EAAT;AACD;AACF,SAJwB,CAAzB;AAKD,OAND;AAOD;;AACD,WAAO,IAAP;AACD;;AAEDL,EAAAA,aAAa,CAAErF,IAAF,EAA4B;AACvC,WAAO,KAAK0B,UAAL,CAAgBN,IAAhB,CAAqB8C,SAAS,IAAIA,SAAS,CAAClE,IAAV,KAAmBA,IAArD,CAAP;AACD;;AAED,MAAI2F,aAAJ,GAA8B;AAC5B,WAAO,KAAKjE,UAAL,CAAgBkE,MAAhB,GAAyB,CAAhC;AACD;;AAED,MAAIlE,UAAJ,GAAoC;AAClC,WAAO,yCAAiBC,GAAjB,CAAqBC,EAAE,IAAI/C,KAAK,CAAC+C,EAAD,CAAhC,CAAP;AACD;;AAED,MAAI5B,IAAJ,GAAoB;AAClB,iCAAO,IAAP;AACD;;AAED,MAAIA,IAAJ,CAAUA,IAAV,EAAwB;AACtB,QAAI,OAAOA,IAAP,KAAgB,QAAhB,IAA4BA,IAAI,KAAK6F,SAAzC,EAAoD;AAClD,yCAAa7F,IAAb;AACD,KAFD,MAEO;AACL,YAAM4E,KAAK,CAAC,uBAAD,CAAX;AACD;AACF;;AAED,MAAIhC,YAAJ,GAA6B;AAAA;;AAC3B,qFAAO,IAAP,uEAAO,uBAAgBA,YAAvB,2EAAuC,KAAvC;AACD;;AAED,MAAIA,YAAJ,CAAkBA,YAAlB,EAAyC;AACvC,QAAI,OAAOA,YAAP,KAAwB,SAA5B,EAAuC;AACrC,6CAAiB,0CAAkB,EAAnC;;AACA,6CAAeA,YAAf,GAA8BA,YAA9B;AACD,KAHD,MAGO;AACL,YAAMgC,KAAK,CAAC,gCAAD,CAAX;AACD;AACF;;AAEDkB,EAAAA,cAAc,CAAEC,WAAF,EAAuB;AACnC,QAAIA,WAAW,IAAI,KAAKnD,YAAxB,EAAsC;AACpC,YAAMgC,KAAK,CAAC,8CAAD,CAAX;AACD;;AACD,QAAI,OAAOmB,WAAP,KAAuB,QAAvB,IAAmCA,WAAW,KAAKF,SAAvD,EAAkE;AAChE,6CAAiB,0CAAkB,EAAnC;;AACA,6CAAeG,GAAf,GAAqBD,WAArB;AACD,KAHD,MAGO;AACL,YAAMnB,KAAK,CAAC,8BAAD,CAAX;AACD;AACF;;AAED,MAAImB,WAAJ,GAA2B;AAAA;;AACzB,2DAAO,IAAP,uEAAO,uBAAgBC,GAAvB;AACD;;AAEDnH,EAAAA,KAAK,GAAU;AACb,WAAO,IAAIiC,IAAJ,CAAS,KAAKW,oBAAL,EAAT,CAAP;AACD;;AAEDwE,EAAAA,MAAM,GAAS;AACb,UAAMC,gBAAgB,GAAGnH,MAAM,CAAC,KAAK0C,oBAAL,EAAD,EAA8B0E,KAAK,IAAI,OAAOA,KAAP,KAAiB,UAAxD,CAA/B;AACA,WAAO1G,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBwG,gBAAlB,CAAP;AACD;;AAEDzE,EAAAA,oBAAoB,GAAS;AAC3B,UAAM2E,WAAW,GAAG3G,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB,IAAlB,CAApB;AACA0G,IAAAA,WAAW,CAAC1E,UAAZ,GAAyB,KAAKA,UAAL,CAAgBC,GAAhB,CAAoBC,EAAE,IAAI/C,KAAK,CAAC+C,EAAD,CAA/B,CAAzB;AACAwE,IAAAA,WAAW,CAACpG,IAAZ,GAAmB,KAAKA,IAAxB;AACAoG,IAAAA,WAAW,CAACvE,QAAZ,yBAAuB,IAAvB;AACA,WAAOuE,WAAP;AACD;;AAxRoC;;gBAA1BtF,I,4BAKqB,CAC9B;AAAE3B,EAAAA,GAAG,EAAE,+BAAP;AAAwC+D,EAAAA,OAAO,EAAE,2BAAjD;AAA8EmD,EAAAA,GAAG,EAAGC,WAAD,IAAsBA,WAAW,CAACC;AAArH,CAD8B,EAE9B;AAAEpH,EAAAA,GAAG,EAAE,+BAAP;AAAwC+D,EAAAA,OAAO,EAAE,4BAAjD;AAA+EmD,EAAAA,GAAG,EAAGC,WAAD,IAAsBA,WAAW,CAACE;AAAtH,CAF8B,EAG9B;AAAErH,EAAAA,GAAG,EAAE,yBAAP;AAAkC+D,EAAAA,OAAO,EAAE,qBAA3C;AAAkEmD,EAAAA,GAAG,EAAGC,WAAD,IAAsBA,WAAW,CAACN;AAAzG,CAH8B,C","sourcesContent":["// @flow\n\nimport { StaticValues, valuesFrom, yesNoValues } from './values'\nimport type { ComponentValues } from './values'\nimport type { DataModel } from './data-model-interface'\nimport { clone } from './helpers'\nimport { ConditionsModel } from './conditions'\n\nfunction filter (obj: any, predicate: function): any {\n  const result = {}\n  let key\n  for (key in obj) {\n    if (obj[key] && predicate(obj[key])) {\n      result[key] = obj[key]\n    }\n  }\n  return result\n}\n\nclass Input {\n  name: string;\n  title: string;\n  propertyPath: string;\n  page: any;\n  #parentItemName: string;\n\n  constructor (rawData: any, page: any, options: any = {}) {\n    Object.assign(this, rawData)\n    const myPage = clone(page)\n    delete myPage.components\n    this.page = myPage\n    this.propertyPath = !options.ignoreSection && page.section ? `${page.section}.${this.name}` : this.name\n    this.#parentItemName = options.parentItemName\n  }\n\n  get displayName () {\n    const titleWithContext = this.#parentItemName ? `${this.title} under ${this.#parentItemName}` : this.title\n    return this.page.section ? `${titleWithContext} in ${this.page.section}` : titleWithContext\n  }\n}\n\nexport class Condition {\n  name: string;\n  displayName: string;\n  value: any;\n\n  constructor (rawData: any) {\n    Object.assign(this, rawData)\n    this.displayName = rawData.displayName || rawData.name\n  }\n\n  get expression () {\n    if (typeof this.value === 'string') {\n      return this.value\n    } else {\n      return ConditionsModel.from(this.value).toExpression()\n    }\n  }\n\n  clone () {\n    return new Condition(this)\n  }\n}\n\nclass ValuesWrapper {\n  values: ComponentValues;\n  data: DataModel;\n\n  constructor (values: ComponentValues, data: DataModel) {\n    this.values = values\n    this.data = data\n  }\n\n  toStaticValues () : StaticValues {\n    return this.values.toStaticValues(this.data)\n  }\n}\n\nexport class Data implements DataModel {\n  /**\n   * FIXME: Ideally I'd have made this part of feedback-context-info.js and moved that inside model\n   * That, however uses relative-url.js, which utilises a URL and the shims for that don't work\n   */\n  static FEEDBACK_CONTEXT_ITEMS = [\n    { key: 'feedbackContextInfo_formTitle', display: 'Feedback source form name', get: (contextInfo: any) => contextInfo.formTitle },\n    { key: 'feedbackContextInfo_pageTitle', display: 'Feedback source page title', get: (contextInfo: any) => contextInfo.pageTitle },\n    { key: 'feedbackContextInfo_url', display: 'Feedback source url', get: (contextInfo: any) => contextInfo.url }\n  ]\n\n  startPage: string;\n  pages: Array<any>;\n  lists: Array<any>;\n  sections: Array<any>;\n  #conditions: Array<any>;\n  #name: string;\n  #feedback: any;\n\n  constructor (rawData: any) {\n    const rawDataClone = rawData instanceof Data ? rawData._exposePrivateFields() : Object.assign({}, rawData)\n    this.#conditions = (rawDataClone.conditions || []).map(it => new Condition(it))\n    this.#feedback = rawDataClone.feedback\n    delete rawDataClone.conditions\n    delete rawDataClone.feedback\n    Object.assign(this, rawDataClone)\n    this.pages = this.pages || []\n    this.lists = this.lists || []\n    this.sections = this.sections || []\n  }\n\n  _listInputsFor (page: any, input: any): Array<Input> {\n    const values = this.valuesFor(input)?.toStaticValues()\n    return values ? values.items.flatMap(listItem => listItem.children\n      ?.filter(it => it.name)\n      ?.map(it => new Input(it, page, { parentItemName: listItem.label })) ?? []) : []\n  }\n\n  allInputs (): Array<Input> {\n    const inputs: Array<Input> = this.pages\n      .flatMap(page => (page.components || [])\n        .filter(component => component.name)\n        .flatMap(it => [new Input(it, page)].concat(this._listInputsFor(page, it)))\n      )\n    if (this.feedbackForm) {\n      const startPage = this.findPage(this.startPage)\n      const options = { ignoreSection: true }\n      Data.FEEDBACK_CONTEXT_ITEMS.forEach(it => {\n        inputs.push(new Input({ type: 'TextField', title: it.display, name: it.key }, startPage, options))\n      })\n    }\n    const names = new Set()\n    return inputs.filter((input: Input) => {\n      const isPresent = !names.has(input.propertyPath)\n      names.add(input.propertyPath)\n      return isPresent\n    })\n  }\n\n  inputsAccessibleAt (path: string): Array<Input> {\n    const precedingPages = this._allPathsLeadingTo(path)\n    return this.allInputs().filter(it => precedingPages.includes(it.page.path) || path === it.page.path)\n  }\n\n  findPage (path: string): any {\n    return this.getPages().find(p => p.path === path)\n  }\n\n  findList (listName: string): any {\n    return this.lists.find(list => list.name === listName)\n  }\n\n  addLink (from: string, to: string, condition: ?string): Data {\n    const fromPage = this.pages.find(p => p.path === from)\n    const toPage = this.pages.find(p => p.path === to)\n    if (fromPage && toPage) {\n      const existingLink = fromPage.next?.find(it => it.path === to)\n      if (!existingLink) {\n        const link = {}\n        link.path = to\n        if (condition) {\n          link.condition = condition\n        }\n\n        fromPage.next = fromPage.next || []\n        fromPage.next.push(link)\n      }\n    }\n    return this\n  }\n\n  addSection (name: string, title: string) : Data {\n    if (!this.sections.find(s => s.name === name)) {\n      this.sections.push({ name, title })\n    }\n    return this\n  }\n\n  updateLink (from: string, to: string, condition: string): Data {\n    const fromPage = this.findPage(from)\n    const toPage = this.pages.find(p => p.path === to)\n    if (fromPage && toPage) {\n      const existingLink = fromPage.next?.find(it => it.path === to)\n      if (existingLink) {\n        if (condition) {\n          existingLink.condition = condition\n        } else {\n          delete existingLink.condition\n        }\n      }\n    }\n    return this\n  }\n\n  updateLinksTo = function (oldPath: string, newPath: string): Data {\n    this.pages.filter(p => p.next && p.next.find(link => link.path === oldPath))\n      .forEach(page => {\n        page.next.find(link => link.path === oldPath).path = newPath\n      })\n    return this\n  }\n\n  addPage (page: any): Data {\n    this.pages.push(page)\n    return this\n  }\n\n  getPages (): Array<any> {\n    return this.pages\n  }\n\n  valuesFor (input: any): ?ValuesWrapper {\n    const values = this._valuesFor(input)\n    if (values) {\n      return new ValuesWrapper(values, this)\n    }\n  }\n\n  _valuesFor (input: any): ?ComponentValues {\n    if (input.type === 'YesNoField') {\n      return yesNoValues\n    }\n    if (input.values) {\n      return valuesFrom(input.values)\n    }\n  }\n\n  _allPathsLeadingTo (path: string): Array<string> {\n    return this.pages.filter(page => page.next && page.next.find(next => next.path === path))\n      .flatMap(page => [page.path].concat(this._allPathsLeadingTo(page.path)))\n  }\n\n  addCondition (name: string, displayName: string, value: any): Data {\n    this.#conditions = this.#conditions\n    if (this.#conditions.find(it => it.name === name)) {\n      throw Error(`A condition already exists with name ${name}`)\n    }\n    this.#conditions.push({ name, displayName, value })\n    return this\n  }\n\n  addComponent (pagePath: string, component: any): Data {\n    const page = this.findPage(pagePath)\n    if (page) {\n      page.components = page.components || []\n      page.components.push(component)\n    } else {\n      throw Error(`No page exists with path ${pagePath}`)\n    }\n    return this\n  }\n\n  updateComponent (pagePath: string, componentName: string, component: any): Data {\n    const page = this.findPage(pagePath)\n    if (page) {\n      page.components = page.components || []\n      const index = page.components.findIndex(it => it.name === componentName)\n      if (index < 0) {\n        throw Error(`No component exists with name ${componentName} with in page with path ${pagePath}`)\n      }\n      page.components[index] = component\n    } else {\n      throw Error(`No page exists with path ${pagePath}`)\n    }\n    return this\n  }\n\n  updateCondition (name: string, displayName: string, value: any): Data {\n    const condition = this.#conditions.find(condition => condition.name === name)\n    if (condition) {\n      condition.displayName = displayName\n      condition.value = value\n    }\n    return this\n  }\n\n  removeCondition (name: string): Data {\n    const condition = this.findCondition(name)\n    if (condition) {\n      this.#conditions.splice(this.#conditions.findIndex(condition => condition.name === name), 1)\n      // Update any references to the condition\n      this.getPages().forEach(p => {\n        Array.isArray(p.next) && p.next.forEach(n => {\n          if (n.if === name) {\n            delete n.if\n          }\n        })\n      })\n    }\n    return this\n  }\n\n  findCondition (name: string): ?Condition {\n    return this.conditions.find(condition => condition.name === name)\n  }\n\n  get hasConditions (): boolean {\n    return this.conditions.length > 0\n  }\n\n  get conditions (): Array<Condition> {\n    return this.#conditions.map(it => clone(it))\n  }\n\n  get name (): string {\n    return this.#name\n  }\n\n  set name (name: string) {\n    if (typeof name === 'string' || name === undefined) {\n      this.#name = name\n    } else {\n      throw Error('name must be a string')\n    }\n  }\n\n  get feedbackForm (): boolean {\n    return this.#feedback?.feedbackForm ?? false\n  }\n\n  set feedbackForm (feedbackForm: boolean) {\n    if (typeof feedbackForm === 'boolean') {\n      this.#feedback = this.#feedback || {}\n      this.#feedback.feedbackForm = feedbackForm\n    } else {\n      throw Error('feedbackForm must be a boolean')\n    }\n  }\n\n  setFeedbackUrl (feedbackUrl: string) {\n    if (feedbackUrl && this.feedbackForm) {\n      throw Error('Cannot set a feedback url on a feedback form')\n    }\n    if (typeof feedbackUrl === 'string' || feedbackUrl === undefined) {\n      this.#feedback = this.#feedback || {}\n      this.#feedback.url = feedbackUrl\n    } else {\n      throw Error('feedbackUrl must be a string')\n    }\n  }\n\n  get feedbackUrl (): string {\n    return this.#feedback?.url\n  }\n\n  clone (): Data {\n    return new Data(this._exposePrivateFields())\n  }\n\n  toJSON (): any {\n    const withoutFunctions = filter(this._exposePrivateFields(), field => typeof field !== 'function')\n    return Object.assign({}, withoutFunctions)\n  }\n\n  _exposePrivateFields (): any {\n    const toSerialize = Object.assign({}, this)\n    toSerialize.conditions = this.conditions.map(it => clone(it))\n    toSerialize.name = this.name\n    toSerialize.feedback = this.#feedback\n    return toSerialize\n  }\n}\n"],"file":"data-model.js"}