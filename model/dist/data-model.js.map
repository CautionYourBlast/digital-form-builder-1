{"version":3,"sources":["../src/data-model.js"],"names":["filter","obj","predicate","result","key","Input","constructor","rawData","page","options","Object","assign","myPage","components","propertyPath","ignoreSection","section","name","parentItemName","displayName","titleWithContext","title","Condition","expression","value","ConditionsModel","from","toExpression","clone","ValuesWrapper","values","data","toStaticValues","Data","oldPath","newPath","pages","p","next","find","link","path","forEach","rawDataClone","_exposePrivateFields","conditions","map","it","feedback","lists","sections","_listInputsFor","input","valuesFor","items","flatMap","listItem","children","label","allInputs","inputs","component","concat","feedbackForm","startPage","findPage","FEEDBACK_CONTEXT_ITEMS","push","type","display","names","Set","isPresent","has","add","inputsAccessibleAt","precedingPages","_allPathsLeadingTo","includes","getPages","findList","listName","list","addLink","to","condition","fromPage","toPage","existingLink","addSection","s","updateLink","addPage","_valuesFor","yesNoValues","addCondition","Error","addComponent","pagePath","updateComponent","componentName","index","findIndex","updateCondition","removeCondition","findCondition","splice","Array","isArray","n","if","hasConditions","length","undefined","setFeedbackUrl","feedbackUrl","url","toJSON","withoutFunctions","field","toSerialize","get","contextInfo","formTitle","pageTitle"],"mappings":"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","sourcesContent":["// @flow\n\nimport { StaticValues, valuesFrom, yesNoValues } from './values'\nimport type { ComponentValues } from './values'\nimport type { DataModel } from './data-model-interface'\nimport { clone } from './helpers'\nimport { ConditionsModel } from './conditions'\n\nfunction filter (obj: any, predicate: function): any {\n  const result = {}\n  let key\n  for (key in obj) {\n    if (obj[key] && predicate(obj[key])) {\n      result[key] = obj[key]\n    }\n  }\n  return result\n}\n\nclass Input {\n  name: string;\n  title: string;\n  propertyPath: string;\n  page: any;\n  #parentItemName: string;\n\n  constructor (rawData: any, page: any, options: any = {}) {\n    Object.assign(this, rawData)\n    const myPage = clone(page)\n    delete myPage.components\n    this.page = myPage\n    this.propertyPath = !options.ignoreSection && page.section ? `${page.section}.${this.name}` : this.name\n    this.#parentItemName = options.parentItemName\n  }\n\n  get displayName () {\n    const titleWithContext = this.#parentItemName ? `${this.title} under ${this.#parentItemName}` : this.title\n    return this.page.section ? `${titleWithContext} in ${this.page.section}` : titleWithContext\n  }\n}\n\nexport class Condition {\n  name: string;\n  displayName: string;\n  value: any;\n\n  constructor (rawData: any) {\n    Object.assign(this, rawData)\n    this.displayName = rawData.displayName || rawData.name\n  }\n\n  get expression () {\n    if (typeof this.value === 'string') {\n      return this.value\n    } else {\n      return ConditionsModel.from(this.value).toExpression()\n    }\n  }\n\n  clone () {\n    return new Condition(this)\n  }\n}\n\nclass ValuesWrapper {\n  values: ComponentValues;\n  data: DataModel;\n\n  constructor (values: ComponentValues, data: DataModel) {\n    this.values = values\n    this.data = data\n  }\n\n  toStaticValues () : StaticValues {\n    return this.values.toStaticValues(this.data)\n  }\n}\n\nexport class Data implements DataModel {\n  /**\n   * FIXME: Ideally I'd have made this part of feedback-context-info.js and moved that inside model\n   * That, however uses relative-url.js, which utilises a URL and the shims for that don't work\n   */\n  static FEEDBACK_CONTEXT_ITEMS = [\n    { key: 'feedbackContextInfo_formTitle', display: 'Feedback source form name', get: (contextInfo: any) => contextInfo.formTitle },\n    { key: 'feedbackContextInfo_pageTitle', display: 'Feedback source page title', get: (contextInfo: any) => contextInfo.pageTitle },\n    { key: 'feedbackContextInfo_url', display: 'Feedback source url', get: (contextInfo: any) => contextInfo.url }\n  ]\n\n  startPage: string;\n  pages: Array<any>;\n  lists: Array<any>;\n  sections: Array<any>;\n  #conditions: Array<any>;\n  #name: string;\n  #feedback: any;\n\n  constructor (rawData: any) {\n    const rawDataClone = rawData instanceof Data ? rawData._exposePrivateFields() : Object.assign({}, rawData)\n    this.#conditions = (rawDataClone.conditions || []).map(it => new Condition(it))\n    this.#feedback = rawDataClone.feedback\n    delete rawDataClone.conditions\n    delete rawDataClone.feedback\n    Object.assign(this, rawDataClone)\n    this.pages = this.pages || []\n    this.lists = this.lists || []\n    this.sections = this.sections || []\n  }\n\n  _listInputsFor (page: any, input: any): Array<Input> {\n    const values = this.valuesFor(input)?.toStaticValues()\n    return values ? values.items.flatMap(listItem => listItem.children\n      ?.filter(it => it.name)\n      ?.map(it => new Input(it, page, { parentItemName: listItem.label })) ?? []) : []\n  }\n\n  allInputs (): Array<Input> {\n    const inputs: Array<Input> = this.pages\n      .flatMap(page => (page.components || [])\n        .filter(component => component.name)\n        .flatMap(it => [new Input(it, page)].concat(this._listInputsFor(page, it)))\n      )\n    if (this.feedbackForm) {\n      const startPage = this.findPage(this.startPage)\n      const options = { ignoreSection: true }\n      Data.FEEDBACK_CONTEXT_ITEMS.forEach(it => {\n        inputs.push(new Input({ type: 'TextField', title: it.display, name: it.key }, startPage, options))\n      })\n    }\n    const names = new Set()\n    return inputs.filter((input: Input) => {\n      const isPresent = !names.has(input.propertyPath)\n      names.add(input.propertyPath)\n      return isPresent\n    })\n  }\n\n  inputsAccessibleAt (path: string): Array<Input> {\n    const precedingPages = this._allPathsLeadingTo(path)\n    return this.allInputs().filter(it => precedingPages.includes(it.page.path) || path === it.page.path)\n  }\n\n  findPage (path: string): any {\n    return this.getPages().find(p => p.path === path)\n  }\n\n  findList (listName: string): any {\n    return this.lists.find(list => list.name === listName)\n  }\n\n  addLink (from: string, to: string, condition: ?string): Data {\n    const fromPage = this.pages.find(p => p.path === from)\n    const toPage = this.pages.find(p => p.path === to)\n    if (fromPage && toPage) {\n      const existingLink = fromPage.next?.find(it => it.path === to)\n      if (!existingLink) {\n        const link = {}\n        link.path = to\n        if (condition) {\n          link.condition = condition\n        }\n\n        fromPage.next = fromPage.next || []\n        fromPage.next.push(link)\n      }\n    }\n    return this\n  }\n\n  addSection (name: string, title: string) : Data {\n    if (!this.sections.find(s => s.name === name)) {\n      this.sections.push({ name, title })\n    }\n    return this\n  }\n\n  updateLink (from: string, to: string, condition: string): Data {\n    const fromPage = this.findPage(from)\n    const toPage = this.pages.find(p => p.path === to)\n    if (fromPage && toPage) {\n      const existingLink = fromPage.next?.find(it => it.path === to)\n      if (existingLink) {\n        if (condition) {\n          existingLink.condition = condition\n        } else {\n          delete existingLink.condition\n        }\n      }\n    }\n    return this\n  }\n\n  updateLinksTo = function (oldPath: string, newPath: string): Data {\n    this.pages.filter(p => p.next && p.next.find(link => link.path === oldPath))\n      .forEach(page => {\n        page.next.find(link => link.path === oldPath).path = newPath\n      })\n    return this\n  }\n\n  addPage (page: any): Data {\n    this.pages.push(page)\n    return this\n  }\n\n  getPages (): Array<any> {\n    return this.pages\n  }\n\n  valuesFor (input: any): ?ValuesWrapper {\n    const values = this._valuesFor(input)\n    if (values) {\n      return new ValuesWrapper(values, this)\n    }\n  }\n\n  _valuesFor (input: any): ?ComponentValues {\n    if (input.type === 'YesNoField') {\n      return yesNoValues\n    }\n    if (input.values) {\n      return valuesFrom(input.values)\n    }\n  }\n\n  _allPathsLeadingTo (path: string): Array<string> {\n    return this.pages.filter(page => page.next && page.next.find(next => next.path === path))\n      .flatMap(page => [page.path].concat(this._allPathsLeadingTo(page.path)))\n  }\n\n  addCondition (name: string, displayName: string, value: any): Data {\n    this.#conditions = this.#conditions\n    if (this.#conditions.find(it => it.name === name)) {\n      throw Error(`A condition already exists with name ${name}`)\n    }\n    this.#conditions.push({ name, displayName, value })\n    return this\n  }\n\n  addComponent (pagePath: string, component: any): Data {\n    const page = this.findPage(pagePath)\n    if (page) {\n      page.components = page.components || []\n      page.components.push(component)\n    } else {\n      throw Error(`No page exists with path ${pagePath}`)\n    }\n    return this\n  }\n\n  updateComponent (pagePath: string, componentName: string, component: any): Data {\n    const page = this.findPage(pagePath)\n    if (page) {\n      page.components = page.components || []\n      const index = page.components.findIndex(it => it.name === componentName)\n      if (index < 0) {\n        throw Error(`No component exists with name ${componentName} with in page with path ${pagePath}`)\n      }\n      page.components[index] = component\n    } else {\n      throw Error(`No page exists with path ${pagePath}`)\n    }\n    return this\n  }\n\n  updateCondition (name: string, displayName: string, value: any): Data {\n    const condition = this.#conditions.find(condition => condition.name === name)\n    if (condition) {\n      condition.displayName = displayName\n      condition.value = value\n    }\n    return this\n  }\n\n  removeCondition (name: string): Data {\n    const condition = this.findCondition(name)\n    if (condition) {\n      this.#conditions.splice(this.#conditions.findIndex(condition => condition.name === name), 1)\n      // Update any references to the condition\n      this.getPages().forEach(p => {\n        Array.isArray(p.next) && p.next.forEach(n => {\n          if (n.if === name) {\n            delete n.if\n          }\n        })\n      })\n    }\n    return this\n  }\n\n  findCondition (name: string): ?Condition {\n    return this.conditions.find(condition => condition.name === name)\n  }\n\n  get hasConditions (): boolean {\n    return this.conditions.length > 0\n  }\n\n  get conditions (): Array<Condition> {\n    return this.#conditions.map(it => clone(it))\n  }\n\n  get name (): string {\n    return this.#name\n  }\n\n  set name (name: string) {\n    if (typeof name === 'string' || name === undefined) {\n      this.#name = name\n    } else {\n      throw Error('name must be a string')\n    }\n  }\n\n  get feedbackForm (): boolean {\n    return this.#feedback?.feedbackForm ?? false\n  }\n\n  set feedbackForm (feedbackForm: boolean) {\n    if (typeof feedbackForm === 'boolean') {\n      this.#feedback = this.#feedback || {}\n      this.#feedback.feedbackForm = feedbackForm\n    } else {\n      throw Error('feedbackForm must be a boolean')\n    }\n  }\n\n  setFeedbackUrl (feedbackUrl: string) {\n    if (feedbackUrl && this.feedbackForm) {\n      throw Error('Cannot set a feedback url on a feedback form')\n    }\n    if (typeof feedbackUrl === 'string' || feedbackUrl === undefined) {\n      this.#feedback = this.#feedback || {}\n      this.#feedback.url = feedbackUrl\n    } else {\n      throw Error('feedbackUrl must be a string')\n    }\n  }\n\n  get feedbackUrl (): string {\n    return this.#feedback?.url\n  }\n\n  clone (): Data {\n    return new Data(this._exposePrivateFields())\n  }\n\n  toJSON (): any {\n    const withoutFunctions = filter(this._exposePrivateFields(), field => typeof field !== 'function')\n    return Object.assign({}, withoutFunctions)\n  }\n\n  _exposePrivateFields (): any {\n    const toSerialize = Object.assign({}, this)\n    toSerialize.conditions = this.conditions.map(it => clone(it))\n    toSerialize.name = this.name\n    toSerialize.feedback = this.#feedback\n    return toSerialize\n  }\n}\n"],"file":"data-model.js"}